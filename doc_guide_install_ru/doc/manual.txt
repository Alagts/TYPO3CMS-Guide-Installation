Установка и обновление TYPO3
Ключ расширения: doc_guide_install_ru
Язык: ru
Версия: 2.0.1
Ключевые слова: forAdmins, forBeginners
Авторские права 2000-2011, Documentation Team, <documentation@typo3.org>

Этот документ публикуется под Open Content License
доступной на http://www.opencontent.org/opl.shtml

Содержимое этого документа относится к TYPO3 
- GNU/GPL CMS/Framework доступной на www.typo3.org






Официальная документация
Этот документ является частью официальной документации TYPO3. Одобрение было получено после экспертной оценки командой по документации TYPO3. Читатель вправе ожидать точной информации в этом документе, о любом несоответствии сообщайте в команду по документации (documentation@typo3.org). Официальные документы сохраняются по возможности актуальными командой по документации.
Перевод официальной документации
Этот документ является переводом официальной документации TYPO3. Перевод может быть не столь актуальным, как оригинал. В случае вопросов, обращайтесь к английской версии. 

Руководство
Этот документ является руководством. Руководства предназначены для ознакомления читателя с конкретной темой с целью получения практического знания по конкретному процессу. Для получения практических знаний о процессе, читатели должны изучить руководство от корки до корки. По завершении, Руководство становится практическим инструментом, справочником, к которому читатель будет обращаться по мере необходимости. Руководство дает советы по достижению поставленной задачи наилучшим способом. 
Содержание
Установка и обновление TYPO3	1
Введение	4
Об этом документе	4
Нововведения	4
Составители	4
Обратная связь	4
Установка TYPO3 – быстрая установка	5
1-2-3	5
Install Tool (инструмент установки)	5
Установка в деталях	11
Выбор пакета и формата файлов	11
Описание состава архивов	12
Эффективное использование архивов с пакетами	13
Преимущества при обновлении	14
Install Tool	14
Обновление	17
1: Резервирование	17
2: Установка нового ядра системы	17
3: Использование мастера обновления (upgrade wizard)	17
4: Сравнение и обновление базы данных	18
5: Установка новых статических таблиц и таблиц описания	19
6: Очистка кешей, временных файлов и пользовательских настроек	21
7: Удаление файлов "temp_CACHED_"	21
8: Проверка ChangeLog и NEWS.txt	21
Устранение неисправностей	22
Файлы кеша в typo3conf/	22
Возможные проблемы с файлами кеша	22
Кеши PHP, классы расширений и т.п.	22
Изменение настроек по обработке изображений	23


Введение
Об этом документе
Это руководство должно помочь в установке и обновлении локальной установкиTYPO3. Оно предназначено для начинающих в TYPO3, работающих администраторами проектов.
Надеемся, что руководство окажется полезным. При нахождении ошибок, опечаток или ошибочных, по Вашему мнению, сведений, сообщайте на http://forge.typo3.org/projects/typo3v4-doc_guide_install/issues. Заранее благодарим!
Нововведения
Обновление шаблона руководства и использование изображений для TYPO3 версии 4.5.
Составители
Изначально руководство было написано Kasper Sk?rh?j и на данный момент сохраняется в актуальном состоянии усилиями команды по документации.
Обратная связь
По общим вопросам о документации, пишите на documentation@typo3.org.
Если найдена ошибка в этом руководстве, опишите проблему по данному руководству в системе отслеживания ошибок: http://forge.typo3.org/projects/typo3v4-doc_guide_install/issues
Поддержка качественной документации является тяжелой работой, и команде по документации всегда нужны добровольцы. Если Вы желаете помочь, присоединяйтесь к списку рассылок (typo3.projects.documentation на lists.typo3.org).

Установка TYPO3 – быстрая установка
1-2-3
1. Скачайте подходящий под требования пакет с http://typo3.org/download/packages/ (если не знаете, какой пакет нужно использовать, обратитесь к разделу “Выбор пакета и формата файлов" данного руководства).
2. Загрузите содержимое скачанного пакета на свой веб сервер. 
Совет
в пакете находятся тысячи файлов, поэтому лучше распаковать пакет непосредственно на сервере!
3. Зайдите на свой сайт из браузера и следуйте шагам в Install Tool (http://www.example.com/typo3/install/index.php?mode=123&step=1). 

Install Tool поможет в следующем:
1. настроить имя пользователя/пароль/базу данных MySQL, 
2. создать необходимое содержимое базы данных по умолчанию и
3. проверить соответствие необходимых настроек установленного PHP. Это описывается далее.
4. По завершении мастера Install Tool необходимо серьезно отнестись к защите папки typo3install/ паролем, либо просто удалить из нее файл ENABLE_INSTALL_TOOL. Этот файл автоматически удаляется спустя один час.
Install Tool (инструмент установки)
Install Tool находится в папке 'typo3/install/' и автоматически переходит в режим "1-2-3" с паролем 'joh316', если база данных для сайта еще не настроена.
Другими словами, вот что Вы увидите:









По завершении основной процедуры установки, ядро TYPO3 будет работать. Но еще остались не настроенными некоторые параметры. Поэтому мы рекомендуем перейти в install tool в обычном режиме для изменения пароля к install tool и детальной проверки своей установки. Для этого щелкните по ссылке "Configure TYPO3". 
С дополнительной информацией можно ознакомиться в разделе "Установка в деталях", и подразделе "Install Tool" далее. 
Установка в деталях
Выбор пакета и формата файлов
TYPO3 доступна в различных "пакетах", каждый из которых доступен в различных форматах.
Какой пакет использовать
Можно загрузить пакет Introduction, Source и Dummy.
Обзор всевозможных доступных пакетов и версий можно найти на http://typo3.org/download/packages/
Introduction пакет (ознакомительный)
Ознакомительный пакет представляет из себя готовый веб сайт. В нем содержатся пакеты Source, Dummy и множество содержимого по умолчанию для тестирования и обучения. Опробуйте его при ознакомлении с системой TYPO3!
Файлы пакета Introduction могу называться следующим образом:
introductionpackage-4.5.0.zip
introductionpackage-4.5.0.tar.gz
TYPO3 Source (ядро системы)
Здесь содержатся файлы ядра TYPO3 CMS. Они обязательны для любой системы TYPO3. В этих папках ничего не изменяется при работе TYPO3. При обновлении, эти папки необходимо заменить.
TYPO3 Dummy (шаблон)
Это шаблон для нового сайта TYPO3. При работе TYPO3 содержимое этих папок изменяется. В будущем, здесь будут находиться файлы, необходимые для текущей установки, например, файлы настроек и изображений, либо документы, представляемые посетителям своего сайта. 
Рекомендации
Для каждого сайта, работающего на TYPO3, необходимы пакеты Dummy и Source. 
Для тестирования и ознакомления рекомендован пакет introduction (ознакомительный). 
Для построения собственного сайта с нуля используйте пакеты dummy и source. В отличие от пакета Introduction, при этом будет получена совсем пустая установка TYPO3. 
Какие форматы файлов использовать
Каждый из пакетов обычно доступен в виде файлов .zip или .tar.gz. Главное отличие в том, что архив .tar.gz использует символические ссылки (symlinks): архив .tar.gz для пакета Dummy содержит симлинки на пакет Source. 
Если используется сервер Windows, необходимо воспользоваться архивами .zip, так как симлинки не просто использовать в среде Windows. 
Если TYPO3 работает на сервере Unix, можно воспользоваться любым из архивов. В основном рекомендуется использовать архивы .tar.gz с симлинками, так как они упрощают обновление. Но используйте их только если знакомы с работой симлинков.
Описание состава архивов
Состав архивов .zip
Состав архива .zip следующий:

Состав архивов .tar.gz
Архивы .tar.gz в основном предназначены для пользователей Unix, так как содержат относительные символические ссылки. Если разархивировать (untar) пакеты dummy и source в одну папку и не изменять названий файлов, автоматически будут получены корректные симлинки.
Папка, в которую будет извлечен пакет Dummy, может в итоге называться как-то вроде "dummy-4.5.0", а содержимое ее будет следующим: 
Главное, в сравнении с архивом .zip, то, что директорию с ядром системы необходимо хранить лишь в одном месте файловой системы сервера Unix. Кроме того, каждый сайт, использующий одну и ту же версию TYPO3, может использовать символические ссылки на папку с ядром системы. Таким образом экономно используется пространство на сервере, уменьшается количество файлов и облегчается обслуживание, например в случае обновления системы. 
Папки и документы TYPO3
Следующие папки и файлы являются частью TYPO3 пакета Source.
t3lib/ и typo3/ содержат исходный код TYPO3, файлы, изображения и сценарии, распространяемые вместе с TYPO3. 
index.php — основной сценарий внешнего интерфейса сайта (то же самое, что и typo3/sysext/cms/tslib/index_ts.php).
clear.gif - однопиксельный 1x1 файл gif. Используется многократно.
NEWS.txt описание изменений в ядре TYPO3 Source произошедших с момента выпуска основной прошлой версии. Обязателен к прочтению при обновлении своей системы.
INSTALL.txt содержит краткие рекомендации по установке.
Все эти файлы являются частью ядра TYPO3. Их нельзя изменять ни при каких обстоятельствах, и при желании можно защитить их! Именно их необходимо обновить при установке новой версии TYPO3.
Папки и документы, относящиеся к сайту
Следующие файлы и папки являются частью пакета TYPO3 Dummy.
fileadmin/ содержит файлы, относящиеся к сайту. Здесь можно поместить, например, шаблоны, внешние сценарии, html и изображения. Кроме того, папка по умолчанию используется для хранения загружаемых файлов. Должна быть доступна для записи пользователю веб сервера.
typo3temp/ в начала должна быть пустой. Но со временем здесь появляются временные файлы. Должна быть доступна для записи пользователю веб сервера.
uploads/ содержит папки для хранения документов, связанных с записями базы данных — следовательно должна быть доступна для записи пользователю веб сервера!
typo3conf/ содержит настройки для локального сайта.
_.htaccess содержат настройки для вебсервера Apache, что сказывается на быстродействии. По умолчанию не используется.
typo3conf/localconf.php файл основных настроек текущей установки, и всех параметров из install tool. Следовательно должен быть доступен для записи пользователю веб сервера.
Пользовательские папки
Можно добавлять и собственные папки, почему бы и нет?
Эффективное использование архивов с пакетами
Архивы .tar.gz для пакета Source имеют преимущество перед архивами .zip: они сокращают используемое файлами пространство и упрощают обслуживание при правильном использовании. Вот, что мы предлагаем:
1. Извлеките где-либо на сервере файл .tar.gz.
2. Создайте символическую ссылку из корневой директории своего веб-сайта на папку с ядром системы. Назовите ее 'typo3_src':
3. После чего создайте ссылки на файл index.php, папки t3lib/ и typo3/, как показано выше. Обратите внимание, что это ссылки, использующие созданную до этого ссылку  typo3_src (в большинстве доступных на текущий момент пакетах Dummy, эти символические ссылки уже включены по умолчанию, остается лишь создать/изменить ссылку typo3_src, указав в ней директорию на ядро системы).
Преимущества при обновлении
Преимущества такого подхода становятся очевидны при обновлении версии системы TYPO3 — необходимо изменить одну лишь символическую ссылку, и все файлы системы TYPO3 будут обновлены!
Помните об Install Tool!
После переключения на другое ядро системы необходимо перейти в Install Tool в каждом из сайтов, использующих то же обновленное ядро, внести требуемые изменения в базу данных и очистить кеш таблиц.
Install Tool
Новый сайт на TYPO3 можно установить либо используя мастер 1-2-3, как было описано выше в разделе "Быстрая установка", либо воспользоваться детальной установкой параметров в расширенном режиме install tool. Расширенные параметры описаны здесь. 
Сначала перейдите на свой сайт и войдите в install tool (http://www.example.com/typo3/install). 
Basic  Сonfiguration
В разделе основных настроек проверяются условия для установки TYPO3. 
Это проверка существования обязательных папок и прав на них. Если в этом разделе что-то неправильно, необходимо добавить требуемые папки и установить нужные права доступа к папкам и файлам в них. 
Затем наступает очередь проверки настроек в php.ini, таких как safe_mode, max_execution_time и т.п. Опять же, если что-либо неверно, необходимо исправить настройки и продолжить.
Одна из важных функцийTYPO3 — возможность работы с изображениями (их преобразование, использование слоев, масок и т.д.). Для этого необходимы freetype, gdlib и ImageMagick или GraphicsMagick. В следующем разделе проверяются их настройки. 
Замечание
Если текст в изображении для freetype выступает за границы, используется Freetype 2 и необходимо установить следующее TYPO3_CONF_VARS[GFX][TTFdpi]=96. 
А в следующем разделе необходимо ввести установки для базы данных. Обратите внимание, что после ввода username и host необходимо сохраниться. После перезагрузки страницы появится блок выбора базы данных.
Выберете название для своего нового веб сайта. Позже оно будет отображено в различных местах внутреннего интерфейса.
Database Analyser
В этом разделе можно получить краткий обзор своей, в настоящий момент выбранной, базы данных, и сравнить ее с необходимыми для правильной работы TYPO3 полями базы данных. Можно также импортировать sql-данные непосредственно в базу данных или модернизировать таблицы более ранних версий TYPO3.
Если Вы перешли сюда в процессе установки своего нового веб сайта, необходимо щелкнуть по "COMPARE", а затем выбрать все изменения и подтвердить их щелчком по кнопке "Write to database". Это может занять время. 
Затем выберете "IMPORT" для импорта статических данных. Статические данные — это некий набор предопределенной информации, используемой в TYPO3, это могут быть, например, названия языков, валют, либо местоположение репозиториев TYPO3. Если Вы не знаете, что необходимо, просто выберете все!
Если режим 1-2-3 не использовался, то понадобится создать пользователя-администратора при помощи щелчка по "Create admin user". 
Замечание: начиная с TYPO3 версии 4.1, InnoDB используется в качестве движка базы данных для нескольких таблиц. Это помогает предотвратить остановки и снижение производительности. Кроме того, InnoDB больше защищена от падений, чем MyISAM. Мы рекомендуем проверить настройку своего MySQL, и убедиться, что для области таблиц включен параметр "autoexpand" (автоматическое расширение). За дополнительной информацией по настройке InnoDB обратитесь к руководству по MySQL. Если InnoDB не включено, MySQL автоматически будет использовать MyISAM и никаких дополнительных действий не понадобится.
Upgrade Wizard
В процессе первоначальной установки TYPO3 мастер обновления не нужен. О нем поговорим позже, в главе об обновлении TYPO3. 
Image Processing
Раздел обработки изображений содержит пояснения по возможностям манипуляции изображений в TYPO3, а также меню тестирования внизу. Воспользуйтесь каждым из тестов, чтобы убедиться в правильности настроек работы с изображениями. При возникновении проблем, прочитайте пояснения к соответствующему тесту с подсказками по решению проблем. Кроме того, посмотрите на настройки обработки изображений в разделе "All configuration". 
Можно найти помощь в разделе, посвященном устранению неисправностей ниже. 
All Сonfiguration
Здесь представлен полный набор параметров, относящихся к установленной TYPO3. Мы предлагаем пройти по всему списку и внимательно прочитать описание каждого из параметров. Так можно получить представление о всех возможных настройках системы. Конечно, сейчас можно изменить любую из настроек, но обычно этого не нужно, так как на предыдущих шагах все основные настройки уже были сделаны. 
Clean Up
В процессе первоначальной установки TYPO3 этот раздел не нужен. В этом разделе собраны методы очистки установленной TYPO3 от накопившегося в процессе работы ненужного мусора. 
phpinfo()
Здесь собрана информация об установленной системе, полные сведения, выводимые phpinfo() и несколько констант, используемых TYPO3, которые окажут неоценимую услугу в поиске и разрешении проблем в процессе настройки.
Edit files in typo3conf/
Здесь возможна непосредственная правка файлов в папке typo3conf/, необходимая для внесения некоторых быстрых поправок. Этим разделом крайне редко пользуются.
About
Раздел "About" описывает каждый из разделов install tool и, что важнее, позволяет изменить пароль к install tool, что необходимо делать каждый раз при установке TYPO3.
Изменение пароля к install tool
Вопрос об изменении пароля к install tool должен быть разрешен в первую очередь в процессе установки TYPO3. Пароль по умолчанию широко известен и никогда не должен использоваться на работающем веб сервере.
Обновление
При выходе очередной версии TYPO3, необходимо тщательно изучить любую дополнительную информацию по обновлению. Нужно изучить включенный файл ChangeLog, чтобы понять, как изменения в функционале отразятся на работе существующего сайта (обратите внимание на строки с отметкой "!!!" - это действительно важная информация!).
В основном при обновлении сайта на TYPO3 будут задействованы следующие шаги:
1: Резервирование
Необходимо сделать резервные копии как папок с файлами, так и базы данных. Возможно сначала Вы решите обновить копию своего сайта, если изменений в работе системы было очень много. Обратитесь к ChangeLog.
2: Установка нового ядра системы
Обновите распространяемые файлы ядра системы их новыми версиями.
При использовании архивов .tar.gz для файлов ядра системы: 
просто извлеките пакет на свой веб сервер и переназначьте симлинк typo3_src.
При использовании архивов .zip для файлов ядра системы: 
Загрузите пакет zip ядра системы, извлеките его и скопируйте (с перезаписью) его содержимое в корневую папку своей системы TYPO3.
3: Использование мастера обновления (upgrade wizard)
Войдите в Install Tool, дополнив адрес своего TYPO3 сайта строчкой '.../typo3/install/'.
(если появились проблемы с паролем/доступом, обратитесь к разделу этого документа, посвященному Install Tool).
Для облегчения обновления TYPO3 предоставляет мастер обновления (upgrade wizard). Перейдите в раздел “Upgrade Wizard” и просмотрите различные предлагаемые мастера. Начать нужно с мастера “Version Compatibility”, который установит совместимость TYPO3 на новую версию. После чего Вы будете перенаправлены к следующему мастеру. Обратите внимание, что некоторые мастера предлагают не обязательные возможности, по, например, установке системных расширений (simulate static или open docs), которые, возможно и не нужны в текущей установке, поэтому внимательно используйте мастеров. 
4: Сравнение и обновление базы данных
Перейдите к разделу "Database Analyser". Здесь можно проверить настройки базы данных и, при необходимости скорректировать их.

Щелкните "Compare". При этом читаются все файлы ext_tables.sql из ядра и расширений и сравниваются с содержимым таблиц и полей текущей базы данных. Будут показаны любые несоответствия и появится возможность выполнить соответствующие запросы, исправляющие любые несоответствия в существующих таблицах требуемой для новой версии TYPO3 структуре таблиц.
Внимание
Не забудьте о полях и/или таблицах, добавленных самостоятельно в базу данных TYPO3 для собственных целей! Такие таблицы и поля будут удалены только если специально отметить их для удаления, конечно же, но будьте начеку и не забывайте о них!
На следующем шаге примененные изменения не будут отображены повторно. Если некоторые поля или таблицы были выбраны для удаления, то будет показано, что они не были фактически удалены, а только лишь переименованы. На данном этапе можно решить оставить их или безвозвратно удалить.
Если все изменения внесены в TYPO3, то после щелчка по "Write to database" будет показано следующее сообщение:

5: Установка новых статических таблиц и таблиц описания
Таблица 'static_template' (и некоторые другие таблицы "static_") содержит информацию, которую никогда нельзя изменять самостоятельно. Здесь содержится статическая информация, распространяемая с выпусками TYPO3. Для обновления информации в упомянутых таблицах воспользуйтесь следующими шагами.
Перейдите в раздел "Database Analyser".
Щелкните "IMPORT" в строке "Dump static data":

Затем установите флажок "Import the whole file..." и щелкните "Write to database":

…после чего должно появиться следующее:

6: Очистка кешей, временных файлов и пользовательских настроек
Всегда нужно очищать кеш таблиц. Перейдите в "Database Analyser" ? "Clear tables" и выберете таблицы, начинающиеся с "cache_". Затем нажмите "Write to database".
После обновления на новую основную версию, кроме того нужно удалить временные файлы, которые TYPO3 сохраняет в папке typo3temp/. Перейдите в "Clean up" и сделайте это.
Может также понадобиться очистка настроек внутренних пользователей. Проблемы могут возникнуть, если что-то при обновлении требует этого. Перейдите в "Database Analyser" ? "Reset user preferences" и запишите в базу данных.
7: Удаление файлов "temp_CACHED_"
В typo3conf/ скорее всего будут находится файлы кеша ext_localconf.php и ext_tables.php. Они также должны быть удалены. 
Все файлы в директории typo3conf/, имеющие в названии "temp_CACHED_*_ext_localconf.php" или "temp_CACHED_*_ext_tables.php" должны быть удалены"
Проще всего сделать это при помощи ссылки, находящейся в правом верхнем углу внутреннего интерфейса при авторизации под пользователем администратором. Откройте меню "Очистить кеш" (Clear cache) и щелкните "Очистить кеш настроек" (Clear configuration cache):

Но таким методом будут удалены лишь два файла "temp_CACHED_" из typo3conf/. Если их больше, то остальные нужно удалить вручную, либо воспользоваться расширением "extdeveval"!
8: Проверка ChangeLog и NEWS.txt
Просмотрите файлы ChangeLog и NEWS.txt в корневой папке TYPO3. Здесь можно почерпнуть идеи о новых интересных функциях.
Особенно внимательно отнеситесь к строкам, начинающимся с "!!!". Это важно, так как они говорят об изменениях, затрагивающих работу некоторых веб сайтов.
Устранение неисправностей
Файлы кеша в typo3conf/
В общем нужно знать, что TYPO3 формирует временные "кешируемые" сценарии в typo3conf/. Это выглядит так:
-rw-r--r--   1 www-data   www-data   61555  2011-01-11 16:28   temp_CACHED_ps3f58_ext_localconf.php
-rw-r--r--   1 www-data   www-data   81995  2011-01-11 16:28   temp_CACHED_ps3f58_ext_tables.php
-rw-r--r--   1 www-data   www-data   47098  2011-01-11 16:28   temp_CACHED_FE_ps3f58_ext_localconf.php
-rw-r--r--   1 www-data   www-data   45517  2011-01-11 16:28   temp_CACHED_FE_ps3f58_ext_tables.php

Могут появиться и другие подобные файлы. Это может произойти из-за дублирования путей, симлинков, либо это просто старые файлы. 
Эти файлы могут быть удалены в любое время, они будут воссозданы при следующем обращении к системе. Эти файлы просто включают все файлы ext_tables.php и ext_localconf.php из установленных расширений, объединенных в порядке загрузки. Поэтому, включение одного такого большого файла PHP равнозначно включению сотен маленьких, но экономит несколько милисекунд системе.
В версии 4.3 TYPO3 появились файлы "temp_CACHED_FE". Они содержат файлы ext_tables.php и ext_localconf.php только тех расширений, которые нужны для формирования выводимого во внешний интерфейс. Поэтому эти файлы меньше, чем файлы temp_CACHED для всех расширений, это сохраняет еще несколько милисекунд. 
Относительно этих файлов нужно знать следующее:
a) Вносить в них изменения не имеет смысла, так как они в любое время могут быть воссозданы из "оригиналов". Вместо этого изменять нужно "оригиналы".
b) Сделав изменения в оригинальных файлах "ext_tables.php" или "ext_localconf.php", необходимо очистить файлы кеша, чтобы изменения были приняты во внимание!
Возможные проблемы с файлами кеша
Изменение абсолютных путей к TYPO3
Изменение пути к установленной TYPO3, может привести к огромному количеству ошибок, вроде "Failed opening …" или "Unable to access ...". Проблема в том, что абсолютные пути к файлам жестко внесены в файлы кеша.
Решение: ручное удаление файлов temp_CACHED_*.php через FTP или файловую систему и перезагрузка страницы.
Кеши PHP, классы расширений и т.п.
Существует ряд ситуаций, на первый взгляд не связанных с обновлением:
Расширение переназначает классы, функции в которых были изменены. 
Решение: попытайтесь отключить все расширения и подключать их одно за одним, пока проблема не возникнет снова.
Кеш PHP имеет ошибки при повторном кешировании сценариев, в частности, если изменения произошли в родительском классе, переназначаемом классом потомком, который не был обновлен. 
Решение: удалите ВСЕ кешируемые файлы PHP (для PHP-Accelerator, удалите "/tmp/phpa_*") и перезапустите Apache.
Изменение настроек по обработке изображений
При изменении настроек по обработке изображений (в обычно режиме), нужно принять во внимание, что старые изображения все еще могут остаться в папке typo3temp/, что может помешать формированию новых файлов! Это особенно важно знать, если Вы впервые настраиваете обработку изображений.
Проблема решается очисткой файлов в папке typo3temp/. Также убедитесь, что очищена таблица "cache_pages" в базе данных. 
